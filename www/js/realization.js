
var carCoords = [{ lat: 54.3614810236932,   lng: 18.642889874214802 }, 
    { lat: 54.361695354457595, lng:  18.642644643302106 }, 
    { lat: 54.36188110912057,  lng: 18.6423013205482 }, 
    { lat: 54.36218117063388,  lng: 18.641957997794293 }, 
    { lat: 54.36245265231745,  lng: 18.64149206089371 }, 
    { lat: 54.36273842093373,  lng: 18.64105064367925 }, 
    { lat: 54.36306705341482,  lng: 18.64048661493746 }, 
    { lat: 54.36335281775671,  lng: 18.639996153112065 }, 
    { lat: 54.36362429322278,  lng: 18.639530215556647 }, 
    { lat: 54.36389576460544,  lng: 18.63908880096153 }, 
    { lat: 54.36437798290995,  lng: 18.638242753919826 }, 
    { lat: 54.36453157703697,  lng: 18.63798526193625 }, 
    { lat: 54.36460658778042,  lng: 18.637813600559298 }, 
    { lat: 54.36479589994549,  lng: 18.63745188538053 }, 
    { lat: 54.364967351591595, lng:  18.637249569771143 }, 
    { lat: 54.36515309040899,  lng: 18.63696755474541 }, 
    { lat: 54.365574538560864, lng:  18.636316916999704 }, 
    { lat: 54.365760273392524, lng:  18.635924549962283 }, 
    { lat: 54.366017445365564, lng:  18.635556702283566 }, 
    { lat: 54.36626032746843,  lng: 18.63501719584724 }, 
    { lat: 54.36653178295473,  lng: 18.63460030355759 }, 
    { lat: 54.366760375456046, lng:  18.63413436632959 }, 
    { lat: 54.36706040132626,  lng: 18.633692951734474 }, 
    { lat: 54.36717469664633,  lng: 18.633472243127244 }, 
    { lat: 54.367388998465046, lng:  18.633128920537047 }, 
    { lat: 54.36756043957268,  lng: 18.632859167318884 }, 
    { lat: 54.367789026348596, lng:  18.63236870549349 }, 
    { lat: 54.36841763513873,  lng: 18.631435845624992 }, 
    { lat: 54.36851763997006,  lng: 18.63123966210628 }, 
    { lat: 54.36871764890213,  lng: 18.6308472921221 }, 
    { lat: 54.36900337354971,  lng: 18.630479447062726 }, 
    { lat: 54.369189093638155, lng:  18.630160646450577 }, 
    { lat: 54.36947481615006,  lng: 18.629694708322177 },  
    { lat: 54.36948618147805,  lng: 18.629537234370105 },
    { lat: 54.369746250771364, lng:  18.62930233956581 }, 
    { lat: 54.369757616405735, lng:  18.62909582108466 }, 
    { lat: 54.36991768203861,  lng: 18.6289099708913 },   
    { lat: 54.37011768415205,  lng: 18.628566648137394 },
    { lat: 54.37014333354574,  lng: 18.628531789723525 },
    { lat: 54.3704147648927,   lng: 18.628016805592665 }, 
    { lat: 54.37061476458516,  lng: 18.627575389687877 },
    { lat: 54.3708719046347,   lng: 18.62723206693397 }, 
    { lat: 54.37117190046841,  lng: 18.62676613134306 }, 
    { lat: 54.371400467142664, lng:  18.626373760049205 }, 
    { lat: 54.371657604560916, lng:  18.625883298878648 }, 
    { lat: 54.371829027086044, lng:  18.625711637501695 }, 
    { lat: 54.37211402943019,  lng: 18.625155784664912 }, 
    { lat: 54.372240809666174, lng:  18.624950404217543 }, 
    { lat: 54.37233187720282,  lng: 18.624751154592104 }, 
    { lat: 54.37247829867903,  lng: 18.62455496992743 }, 
    { lat: 54.37258543622424,  lng: 18.6243373278362 }, 
    { lat: 54.37272828572253,  lng: 18.624104358772 }, 
    { lat: 54.372838993656046, lng:  18.623902043510498 }, 
    { lat: 54.372931845346486, lng:  18.623764101439292 }, 
    { lat: 54.37300505515166,  lng: 18.62365068232839 }, 
    { lat: 54.37305118241285,  lng: 18.623532661711806 }, 
    { lat: 54.37320117264309,  lng: 18.6232261224161 }, 
    { lat: 54.37332259225046,  lng: 18.62306672366526 }, 
    { lat: 54.37349400896907,  lng: 18.622760185679226 }, 
    { lat: 54.373686851588324, lng:  18.622429124078053 }, 
    { lat: 54.37382969706413,  lng: 18.622281985006566 }, 
    { lat: 54.373972541852226, lng:  18.621987709319228 }, 
    { lat: 54.37410110251857,  lng: 18.62180378547987 }, 
    { lat: 54.37428679993365,  lng: 18.621509508728423 }, 
    { lat: 54.37442250080223,  lng: 18.621288801430865 }, 
    { lat: 54.37462962326947,  lng: 18.62094547863603 }, 
    { lat: 54.37472247107755,  lng: 18.620687986550138 }, 
    { lat: 54.374801034340756, lng:  18.620430494469474 }, 
    { lat: 54.374828233948655, lng:  18.620311013649825 }, 
    { lat: 54.37490679681878,  lng:  18.619918644320478 }, 
    { lat: 54.375028212145246, lng:  18.619538537453536 }, 
    { lat: 54.375071065088584, lng:  18.61919521469963 }, 
    { lat: 54.3751781957256,   lng: 18.618864153589584 }, 
    { lat: 54.37521033484312,  lng: 18.618600530129243 }, 
    { lat: 54.37528889698211,  lng: 18.618165246274202 }, 
    { lat: 54.375374600944944, lng:  18.617901623468697 }, 
    { lat: 54.3754210242236,   lng: 18.617662523869058 }, 
    { lat: 54.37549244400697,  lng: 18.61738050818849 }, 
    { lat: 54.37555672153418,  lng: 18.617129147272408 }, 
    { lat: 54.37561385760157,  lng: 18.616877785824272 }, 
    { lat: 54.37564242531939,  lng: 18.616724516790327 }, 
    { lat: 54.37574598360658,  lng: 18.61638119403642 },  
    { lat: 54.37609438440737,  lng: 18.614748165598485 }, 
    { lat: 54.376194370496215, lng:  18.61468685787031 }, 
    { lat: 54.37629614193794,  lng: 18.614711380830613 }, 
    { lat: 54.37638005849161,  lng: 18.61478188483261 }, 
    { lat: 54.37647647294627,  lng: 18.614867715521086 }, 
    { lat: 54.376606810759334, lng:  18.614965807689714 }, 
    { lat: 54.3766960830576,   lng: 18.615048573090007 }, 
    { lat: 54.37677821331383,  lng: 18.615116011394548 }, 
    { lat: 54.37688533954253,  lng: 18.615195711506658 }, 
    { lat: 54.37695969575355,  lng: 18.61524566151286 }, 
    { lat: 54.377077533884545, lng:  18.615297773049065 }, 
    { lat: 54.377152521714,    lng: 18.61534681896967 }, 
    { lat: 54.37727035967295,  lng: 18.61542651908178 }, 
    { lat: 54.377373913758575, lng:  18.61546330344038 }, 
    { lat: 54.37745068640214,  lng: 18.61553687273056 }, 
    { lat: 54.377658686218695, lng:  18.61564722650212 }, 
    { lat: 54.37773724374426,  lng: 18.615697805230525 }, 
    { lat: 54.37780419611279,  lng: 18.615740720574763 }, 
    { lat: 54.37786489950099,  lng: 18.61577750526078 }, 
    { lat: 54.37792649547873,  lng: 18.615832682003315 }, 
    { lat: 54.37797023749058,  lng: 18.615875597347554 }, 
    { lat: 54.37801495065249,  lng: 18.615865206635135 }, 
    { lat: 54.378164922749974, lng:  18.61593877617088 }, 
    { lat: 54.378325606395926, lng:  18.616042998588455 }, 
    { lat: 54.37848628960367,  lng: 18.616122698700565 }, 
    { lat: 54.37862911857248,  lng: 18.616202398812675 }, 
    { lat: 54.37878980078293,  lng: 18.61626370637714 }, 
    { lat: 54.37896655016383,  lng: 18.6163158179952 }, 
    { lat: 54.37905046125919,  lng: 18.616355668214965 }, 
    { lat: 54.37914329873606,  lng: 18.616398583559203 }, 
    { lat: 54.37923613614604,  lng: 18.616432302547764 }, 
    { lat: 54.37934325591491,  lng: 18.61646295657556 }, 
    { lat: 54.37939503042369,  lng: 18.616499740852305 }, 
    { lat: 54.37952535904257,  lng: 18.616530394716392 }, 
    { lat: 54.37970567589951,  lng: 18.61657790823847 }, 
    { lat: 54.37974048945504,  lng: 18.616607029294755 }, 
    { lat: 54.37973781149967,  lng: 18.616694392872887 }, 
    { lat: 54.37973513354266,  lng: 18.61680934461765 }, 
    { lat: 54.379732455563094, lng:  18.616879848374083 }];


var polyToGo;
var polyTraveled;
var map;
var marker;

var carSymbol;

function clearBasket(){
    $.ajax({
        method: "DELETE",
        url: GLOBALS_siteUrl+"basket/products",
    }).done(function(response) {
        loadOrder();
    });
}

function realization() {

    $('.modal').fadeOut();
                initRealizationMap();

    clearBasket();
}

function realizationFinished() {
    let p = $('.bouncingBall .ball');
    let left = p.offset().left;
    let top = p.offset().top;

    console.log('todo');
}

function initRealizationMap() {
    var directionsDisplay = new google.maps.DirectionsRenderer;
    map = new google.maps.Map(document.getElementById('realizationMap'), {
      zoom: 7,
      center: {lat: 54.372158, lng: 18.638306},
      disableDefaultUI: true,
      styles: [
        {
            "featureType": "administrative",
            "elementType": "labels.text.fill",
            "stylers": [
                {
                    "color": "#6195a0"
                }
            ]
        },
        {
            "featureType": "administrative.country",
            "elementType": "all",
            "stylers": [
                {
                    "visibility": "off"
                }
            ]
        },
        {
            "featureType": "administrative.province",
            "elementType": "all",
            "stylers": [
                {
                    "visibility": "off"
                }
            ]
        },
        {
            "featureType": "administrative.province",
            "elementType": "geometry.stroke",
            "stylers": [
                {
                    "visibility": "off"
                }
            ]
        },
        {
            "featureType": "administrative.locality",
            "elementType": "all",
            "stylers": [
                {
                    "visibility": "on"
                }
            ]
        },
        {
            "featureType": "administrative.locality",
            "elementType": "labels",
            "stylers": [
                {
                    "visibility": "on"
                }
            ]
        },
        {
            "featureType": "administrative.neighborhood",
            "elementType": "all",
            "stylers": [
                {
                    "visibility": "on"
                }
            ]
        },
        {
            "featureType": "administrative.land_parcel",
            "elementType": "all",
            "stylers": [
                {
                    "visibility": "off"
                }
            ]
        },
        {
            "featureType": "landscape",
            "elementType": "geometry",
            "stylers": [
                {
                    "lightness": "0"
                },
                {
                    "saturation": "0"
                },
                {
                    "color": "#f5f5f2"
                },
                {
                    "gamma": "1"
                }
            ]
        },
        {
            "featureType": "landscape.man_made",
            "elementType": "all",
            "stylers": [
                {
                    "lightness": "-3"
                },
                {
                    "gamma": "1.00"
                }
            ]
        },
        {
            "featureType": "landscape.natural.terrain",
            "elementType": "all",
            "stylers": [
                {
                    "visibility": "off"
                }
            ]
        },
        {
            "featureType": "poi",
            "elementType": "all",
            "stylers": [
                {
                    "visibility": "off"
                }
            ]
        },
        {
            "featureType": "poi.park",
            "elementType": "geometry.fill",
            "stylers": [
                {
                    "color": "#bae5ce"
                },
                {
                    "visibility": "on"
                }
            ]
        },
        {
            "featureType": "road",
            "elementType": "all",
            "stylers": [
                {
                    "saturation": -100
                },
                {
                    "lightness": 45
                },
                {
                    "visibility": "simplified"
                }
            ]
        },
        {
            "featureType": "road.highway",
            "elementType": "all",
            "stylers": [
                {
                    "visibility": "simplified"
                }
            ]
        },
        {
            "featureType": "road.highway",
            "elementType": "geometry.fill",
            "stylers": [
                {
                    "color": "#fac9a9"
                },
                {
                    "visibility": "simplified"
                }
            ]
        },
        {
            "featureType": "road.highway",
            "elementType": "labels.text",
            "stylers": [
                {
                    "color": "#4e4e4e"
                }
            ]
        },
        {
            "featureType": "road.arterial",
            "elementType": "labels.text.fill",
            "stylers": [
                {
                    "color": "#787878"
                }
            ]
        },
        {
            "featureType": "road.arterial",
            "elementType": "labels.icon",
            "stylers": [
                {
                    "visibility": "off"
                }
            ]
        },
        {
            "featureType": "transit",
            "elementType": "all",
            "stylers": [
                {
                    "visibility": "simplified"
                }
            ]
        },
        {
            "featureType": "transit.station.airport",
            "elementType": "labels.icon",
            "stylers": [
                {
                    "hue": "#0a00ff"
                },
                {
                    "saturation": "-77"
                },
                {
                    "gamma": "0.57"
                },
                {
                    "lightness": "0"
                }
            ]
        },
        {
            "featureType": "transit.station.rail",
            "elementType": "labels.text.fill",
            "stylers": [
                {
                    "color": "#43321e"
                }
            ]
        },
        {
            "featureType": "transit.station.rail",
            "elementType": "labels.icon",
            "stylers": [
                {
                    "hue": "#ff6c00"
                },
                {
                    "lightness": "4"
                },
                {
                    "gamma": "0.75"
                },
                {
                    "saturation": "-68"
                }
            ]
        },
        {
            "featureType": "water",
            "elementType": "all",
            "stylers": [
                {
                    "color": "#eaf6f8"
                },
                {
                    "visibility": "on"
                }
            ]
        },
        {
            "featureType": "water",
            "elementType": "geometry.fill",
            "stylers": [
                {
                    "color": "#c7eced"
                }
            ]
        },
        {
            "featureType": "water",
            "elementType": "labels.text.fill",
            "stylers": [
                {
                    "lightness": "-49"
                },
                {
                    "saturation": "-53"
                },
                {
                    "gamma": "0.79"
                }
            ]
        }
    ]
    });

    carSymbol = {
        path: 'M 29.395 0 H 17.636 c -3.117 0 -5.643 3.467 -5.643 6.584 v 34.804 c 0 3.116 2.526 5.644 5.643 5.644 h 11.759 c 3.116 0 5.644 -2.527 5.644 -5.644 V 6.584 C 35.037 3.467 32.511 0 29.395 0 Z M 34.05 14.188 v 11.665 l -2.729 0.351 v -4.806 L 34.05 14.188 Z M 32.618 10.773 c -1.016 3.9 -2.219 8.51 -2.219 8.51 H 16.631 l -2.222 -8.51 C 14.41 10.773 23.293 7.755 32.618 10.773 Z M 15.741 21.713 v 4.492 l -2.73 -0.349 V 14.502 L 15.741 21.713 Z M 13.011 37.938 V 27.579 l 2.73 0.343 v 8.196 L 13.011 37.938 Z M 14.568 40.882 l 2.218 -3.336 h 13.771 l 2.219 3.336 H 14.568 Z M 31.321 35.805 v -7.872 l 2.729 -0.355 v 10.048 L 31.321 35.805 Z',
        fillColor: 'black',
        scale: 1,
        anchor: new google.maps.Point(25,20),
        strokeWeight: 4
      };

    directionsDisplay.setMap(map);


    polyToGo = new google.maps.Polyline({
        path: carCoords.reverse(),
        strokeColor: '#7af442',
        strokeOpacity: 1.0,
        strokeWeight: 3,
      });
      
    polyTraveled = new google.maps.Polyline({
        path: [ carCoords[carCoords.length-1] ],
        strokeColor: '#000000',
        strokeOpacity: 1.0,
        strokeWeight: 3,
        icons: [{
            icon: carSymbol,
            offset: '100%'
          }],
      });
      
    polyToGo.setMap(map);
    polyTraveled.setMap(map);

    var i = 0;                    

    function loopCar () {          
    setTimeout(function () {
        calculateAndDisplayRoute();    
        updateTime(i);  
        i++;                     
        if (i < carCoords.length-1) {           
            loopCar();             
        } 
    }, 500)
    }

    loopCar();     
  }
function updateTime(i){
    var realTime = "1:20";
    var time = 120 - i;
    var minutes = Math.floor(time/60);
    var secs = time - minutes*60;
    if(secs<10){
        secs = "0"+secs;
    }

    realTime = minutes+":"+secs;

    $("#realizationTime").text(realTime);
}
function calculateAndDisplayRoute() {
    var path1 = polyToGo.getPath();
    var path2 = polyTraveled.getPath();
    path1.pop();
    var pt2 = path1.getAt(path1.getLength()-1);
    path2.push(pt2);
    zoomToObject(polyToGo);
  }

function zoomToObject(obj){
    var bounds = new google.maps.LatLngBounds();
    var points = obj.getPath().getArray();

    if (points.length === 0)
    {
        return;
    }

    for (var n = 0; n < points.length ; n++){
        bounds.extend(points[n]);
    }
    map.fitBounds(bounds);
}
